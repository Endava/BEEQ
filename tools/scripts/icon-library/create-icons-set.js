'use strict';

const fs = require('fs');
const { join, parse } = require('path');
const prettier = require('prettier');

const iconSet = 'icons-set.ts';
const iconDir = join(__dirname, '../../../libs/bee-q/src/components/icon/');
const iconSVGDir = join(iconDir, 'svg/regular');
const iconHelperDir = join(iconDir, 'helper');

const files = fs.readdirSync(iconSVGDir).sort();
const svgArrayNames = files.filter((filename) => filename !== 'web.config').map((filename) => parse(filename).name);

const fileContent = `
/**
 * ❗️❗️ This file gets autogenerated from the command line by running:
 * "nx run bee-q:create-icons-set"
 *
 * ❌ Please do not modify it manually, always use 'nx run bee-q:create-icons-set'
 * and commit any change resulted after running the build command.
 */

export const ICONS_SET
`;

const formattedContent = prettier.format(`${fileContent}=${JSON.stringify(svgArrayNames)}`, {
  parser: 'babel',
  bracketSpacing: true,
  endOfLine: 'auto',
  semi: true,
  singleQuote: true,
  trailingComma: 'all',
});

fs.writeFile(`${iconHelperDir}/${iconSet}`, formattedContent, (err) => {
  if (err) {
    console.error('❌ Something went wrong while creating the icons set');
    throw new Error(err.message);
  }
  console.log('✅ Bee-q icons set created successfully!! 🎉 ');
});
